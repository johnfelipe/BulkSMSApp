@model BulkSMSWebApp.ViewModels.ContactoCelGrupo
@using BulkSMSWebApp.Helpers;


@{
    ViewBag.Title = "Listado de Contactos";
}

<p>
    <a href="@Url.Action("Create","Contacto")" class="btn btn-info">
        Nuevo Contacto
        <span class="fa fa-fw fa-plus-circle"></span>
    </a>
</p>


<script>

    $(function () {

        var table = $('#myTable').dataTable({
            "lengthMenu": [[5, 10, 20, -1], [5, 10, 20, "Todos"]]
        });

        var tabla = $('#myTable').DataTable()
        var allRows = table.fnGetNodes();

        $('#myTable').delegate(".selected", "click", function () {
            for (var i = 0; i < allRows.length; i++) {
                tabla.rows('.success').nodes().to$().removeClass('success');
            }
            $(this).parents('tr').addClass('success');
        });


        $("#myTable").delegate(".open-dialog", "click", function () {
            var idActual = $(this).data('id');
            $(".idContacto").prepend("<input type='hidden' name='id' value='" + idActual + "'>");
        })

        $("#myTable").delegate(".activar_opendialog", "click", function () {
            var idActual = $(this).data('id');
            $(".idContacto").prepend("<input type='hidden' name='id' value='" + idActual + "'>");
        })

        //$("#myTable").delegate(".detalles", "click", function () {
        //    var idActual = $(this).data('id');
        //    $(".divhidden #contactoid").val(idActual);
        //})
    });
</script>

</br>

<div class="table-responsive">
    <table class="table table-hover table-striped" id="myTable">
        <thead>
            <tr class="label-info">
                <th> Nombres </th>
                <th> Apellidos </th>
                <th> Departamento </th>
                <th> Email </th>
                <th> Estado </th>
                <th>Opciones</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var item in Model.Contactos)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Nombres)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Apellidos)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Departamento.NombreDepartameto)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Email)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Estado.NombreEstado)
                    </td>

                    <td>
                        @Ajax.RawActionLink(string.Format("<span class='fa fa-hand-pointer-o'> Seleccionar </span>"), "Index", "Contacto", new { id = item.ContactoID },
                        new AjaxOptions
                        {
                            HttpMethod = "GET",
                            UpdateTargetId = "tablaTelefonos",
                            InsertionMode = InsertionMode.Replace
                        }, new { @class = "selected" })



                        <br />
                        <a href="@Url.Action("Edit", "Contacto", new { id = @item.ContactoID })">
                            <span class="fa fa-edit"></span>
                            Editar
                        </a>
                        <br />

                        @*<a data-toggle="modal" data-id="@item.ContactoID" class=".detalles selected" href="#detalleContacto">
                        
                            <span class="fa fa-info-circle"></span>
                            Detalles
                        </a>
                        <br />*@
                      
                        @if (item.EstadoID == 1 && User.IsInRole("Administrador"))
                        {
                            <a data-toggle="modal" data-id="@item.ContactoID" class="open-dialog selected" href="#deleteConfirmModal">
                                <span class="fa fa-trash"></span>
                                Desactivar
                            </a>
                        }

                        @if (item.EstadoID == 2 && User.IsInRole("Administrador"))
                        {
                            <a data-toggle="modal" data-id="@item.ContactoID" class="activar_opendialog selected" href="#activeConfirmModal">
                                <span class="fa fa-check"></span>
                                Activar
                            </a>
                        }

                    </td>
                </tr>
            }

        </tbody>

    </table>

</div>

<div id="tablaTelefonos" class="table-responsive">

</div>



@section Modal {

    @{ Html.RenderPartial("_ActivarConfirmationModal"); }
    @{ Html.RenderPartial("_DeleteConfirmationModal"); }


}

@section Scripts{

}